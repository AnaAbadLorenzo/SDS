/* BASE DE DATOS*/

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*CREACION DE LA CUENTA DE USUARIO*/

CREATE USER 'user_sds'@'%' IDENTIFIED VIA mysql_native_password USING '***';GRANT ALL PRIVILEGES ON *.* TO 'user_sds'@'%' 
REQUIRE NONE WITH GRANT OPTION MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;

/*CREACION DE LA BD*/

DROP DATABASE IF EXISTS sds;

CREATE DATABASE sds CHARSET UTF8MB4;

USE sds;

DROP TABLE IF EXISTS `persona`;
DROP TABLE IF EXISTS `usuario`;
DROP TABLE IF EXISTS `empresa`;
DROP TABLE IF EXISTS `rol`;
DROP TABLE IF EXISTS `accion`;
DROP TABLE IF EXISTS `funcionalidad`;
DROP TABLE IF EXISTS `rolaccionfuncionalidad`;

--
-- Estructura de tabla para la tabla `accion`
--

CREATE TABLE `accion` (
  `idAccion` int(11) NOT NULL AUTO_INCREMENT,
  `nombreAccion` varchar(48) NOT NULL,
  `descripAccion` text NOT NULL,
  `borradoAccion` int(1) NOT NULL,
   PRIMARY KEY (`idAccion`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `empresa`
--

CREATE TABLE `empresa` (
  `idEmpresa` int(11) NOT NULL AUTO_INCREMENT,
  `cifEmpresa` varchar(9) NOT NULL,
  `nombreEmpresa` varchar(48) NOT NULL,
  `direccionEmpresa` varchar(128) NOT NULL,
  `telefonoEmpresa` varchar(9) NOT NULL,
  `borradoEmpresa` int(1) NOT NULL,
  PRIMARY KEY (`idEmpresa`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `funcionalidad`
--

CREATE TABLE `funcionalidad` (
  `idFuncionalidad` int(11) NOT NULL AUTO_INCREMENT,
  `nombreFuncionalidad` varchar(48) NOT NULL,
  `descripFuncionalidad` text NOT NULL,
  `borradoFuncionalidad` int(1) NOT NULL,
   PRIMARY KEY (`idFuncionalidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `persona`
--

CREATE TABLE `persona` (
  `dniP` varchar(9) NOT NULL,
  `nombreP` varchar(56) NOT NULL,
  `apellidosP` varchar(128) NOT NULL,
  `fechaNacP` date NOT NULL,
  `direccionP` varchar(128) NOT NULL,
  `telefonoP` varchar(9) NOT NULL,
  `emailP` varchar(48) NOT NULL,
  `borradoP` int(1) NOT NULL,
   PRIMARY KEY (`dniP`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `rol`
--
CREATE TABLE `rol` (
  `idRol` int(11) NOT NULL AUTO_INCREMENT,
  `rolName` varchar(32) NOT NULL,
  `rolDescription` text NOT NULL,
  PRIMARY KEY(`idRol`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `rolaccionfuncionalidad`
--

CREATE TABLE `rolaccionfuncionalidad` (
  `idRol` int(11) NOT NULL,
  `idAccion` int(11) NOT NULL,
  `idFuncionalidad` int(11) NOT NULL,
   PRIMARY KEY (`idRol`,`idAccion`,`idFuncionalidad`),
   KEY `id_rol_idx` (`idRol`),
   KEY `id_accion_idx` (`idAccion`),
   KEY `id_funcionalidad_idx` (`idFuncionalidad`),
   INDEX `rolaccionfuncionalidad_accion_fk`(`idAccion`),
   INDEX `rolaccionfuncionalidad_funcionalidad_fk` (`idFuncionalidad`),
   INDEX `rolaccionfuncionalidad_rol_fk`(`idRol`),
   CONSTRAINT `rolaccionfuncionalidad_accion_fk` FOREIGN KEY (`idAccion`) REFERENCES `accion` (`idAccion`),
   CONSTRAINT `rolaccionfuncionalidad_funcionalidad_fk` FOREIGN KEY (`idFuncionalidad`) REFERENCES `funcionalidad` (`idFuncionalidad`),
   CONSTRAINT `rolaccionfuncionalidad_rol_fk` FOREIGN KEY (`idRol`) REFERENCES `rol` (`idRol`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla `usuario`
--

CREATE TABLE `usuario` (
  `idUsuario` int(11) NOT NULL AUTO_INCREMENT,
  `dniUsuario` varchar(9) NOT NULL,
  `usuario` varchar(32) NOT NULL,
  `passwdUsuario` varchar(32) NOT NULL,
  `borradoUsuario` int(1) NOT NULL,
  `idRol` int(11) NOT NULL,
  `idEmpresa` int(11) NOT NULL,
   PRIMARY KEY (`idUsuario`),
   UNIQUE KEY `dniUsuario_UNIQUE` (`dniUsuario`),
   KEY `id_rol_usuario_idx` (`idRol`),
   INDEX `dniUsuario_fk`(`dniUsuario`),
   INDEX `idRol_fk`(`idRol`),
   CONSTRAINT `dniUsuario_fk` FOREIGN KEY (`dniUsuario`) REFERENCES `persona` (`dniP`) ON DELETE NO ACTION ON UPDATE CASCADE,
   CONSTRAINT `idRol_fk` FOREIGN KEY (`idRol`) REFERENCES `rol` (`idRol`) ON DELETE NO ACTION ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
